(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{79043:function(e,t,a){"use strict";a.d(t,{i:function(){return s.Z},r:function(){return l.Z}});var s=a(68114),l=a(77832)},62166:function(e,t,a){Promise.resolve().then(a.bind(a,15964))},15964:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return EarnPage}});var s=a(57437),l=a(45428),n=a(91056),r=a(85156),i=a(8580),o=a(72009),c=a(56926),u=a(30197),d=a(43003),m=a(81628),v=a(99057),x=a(20373),f=a(34522),b=a(79043),h=a(16691),p=a.n(h),g=a(2265),y=a(76036),k=a(92697),j=a(80547),N=a(72084);function TokenValue(e){let{symbol:t,value:a,decimals:l}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,x.dq)(a,l),(0,s.jsx)(p(),{className:"inline-block",alt:"usb",width:16,height:16,src:"/".concat(t,".svg")})]})}function DualTokenCard(e){var t,a;let{type:h,vc:T}=e,A="buy"==h,S=A?r.O[(0,n.B)()]:T.assetTokenAddress,w=A?"USB":T.assetTokenSymbol,C=A?T.assetTokenSymbol:"USB",R=A?"Buy ".concat(T.assetTokenSymbol," Low"):"Sell ".concat(T.assetTokenSymbol," High"),_=A?T.ptyPoolBelowAddress:T.ptyPoolAboveAddress,{prices:B,balances:P,earns:E,vaultsState:M,assetLocked:V,vaultUSBTotal:q}=(0,g.useContext)(v.FetcherContext),D=M[T.vault],F=E[_],W=(0,g.useMemo)(()=>{var e;return null==P?void 0:null===(e=P.find(e=>e.symbol===w))||void 0===e?void 0:e.balance},[P,w]),[Z,z]=(0,g.useState)(""),[I,U]=(0,g.useState)(""),$=A?T.xTokenSymbol:T.assetTokenSymbol,L=A?T.assetTokenSymbol:T.xTokenSymbol,O=(0,g.useMemo)(()=>{var e,t;return(null!==(e=null==F?void 0:F.totalStake)&&void 0!==e?e:0n)*(null!==(t=B[w])&&void 0!==t?t:i.Pq)/i.Pq},[B[w],null==F?void 0:F.totalStake]),H=A?null==D?void 0:D.AARS:null==D?void 0:D.AARU,Y=null!==(t=V[T.assetTokenSymbol])&&void 0!==t?t:0n,J=null!==(a=q[T.vault])&&void 0!==a?a:0n,K=(0,g.useMemo)(()=>H&&D.AARDecimals&&0n!=Y&&0n!=J?H*J*i.Pq/D.AARDecimals/Y/BigInt(1e9):B[T.assetTokenSymbol],[H,J,D.AARDecimals,Y]),G=function(e){let{address:t,token:a}=e,s=a==o.K8,{data:l}=(0,c.KQ)({address:t,enabled:s}),{data:n}=(0,c.do)({abi:u.em,address:a,functionName:"balanceOf",args:[t],enabled:!s});return s?null==l?void 0:l.value:n}({address:_,token:A?T.assetTokenAddress:T.xTokenAddress}),Q=(0,g.useMemo)(()=>{var e;let t=null!==(e=null==F?void 0:F.totalStake)&&void 0!==e?e:0n;return 0n==t?"0.00%":(0,m.Jh)((null!=G?G:0n)*i.Pq/t,18,2)},[null==F?void 0:F.totalStake,G]),{data:X}=(0,c.do)({abi:l.Z,address:_,functionName:"getRecentStakeYields"}),ee=(0,g.useMemo)(()=>{var e;if(!X||0==X.length||!O||0n==O)return"0.00%";let[t,a]=X.reduce((e,t)=>[e[0]+t[0],e[1]+t[1]],[0n,0n]),s=BigInt(31536e3),l=a*(null!==(e=B[$])&&void 0!==e?e:0n)*s/t/i.Pq;return(0,m.Jh)(l*i.Pq/O,18,2)},[X,B[$],O]),et=(0,g.useMemo)(()=>{var e,t;let a=A?[{key:"staked",label:"".concat(w," Staked"),value:(0,s.jsx)(TokenValue,{symbol:w,value:null==F?void 0:F.stake})},{key:"successfully_bought",label:"Successfully Bought",value:(0,s.jsx)(TokenValue,{symbol:C,value:null==F?void 0:F.match})},{key:"stake_earned",label:"".concat($," earned"),value:(0,s.jsx)(TokenValue,{symbol:$,value:null==F?void 0:F.earn,decimals:6})},{key:"transacation_reward_pool",label:"Transaction Reward Pool",value:(0,s.jsx)(TokenValue,{symbol:L,value:G,decimals:6})},{key:"stake_yield_apr",label:"".concat($," yield APR"),value:ee},{key:"discount_rate",label:"Discount Rate",value:"".concat(Q," (Est.)")},{key:"usb_rebasable_apr",label:"USB Rebasable APR",value:(0,m.Rr)(null!==(e=D.Y)&&void 0!==e?e:0n,null!==(t=D.settingsDecimals)&&void 0!==t?t:0)}]:[{key:"staked",label:"".concat(w," Staked"),value:(0,s.jsx)(TokenValue,{symbol:w,value:null==F?void 0:F.stake})},{key:"successfully_bought",label:"Successfully Bought",value:(0,s.jsx)(TokenValue,{symbol:C,value:null==F?void 0:F.match})},{key:"stake_earned",label:"".concat($," earned"),value:(0,s.jsx)(TokenValue,{symbol:$,value:null==F?void 0:F.earn,decimals:6})},{key:"transacation_reward_pool",label:"Transaction Reward Pool",value:(0,s.jsx)(TokenValue,{symbol:L,value:G,decimals:6})},{key:"stake_yield_apr",label:"".concat($," yield APR"),value:ee},{key:"discount_rate",label:"Discount Rate",value:"".concat(Q," (Est.)")}];return a},[F,G]),{write:ea,isLoading:es}=(0,d.R)({abi:l.Z,address:_,functionName:"claimAll"});return(0,s.jsxs)("div",{className:"card flex flex-col",children:[(0,s.jsxs)("div",{className:"relative w-fit",children:[(0,s.jsx)(p(),{width:40,height:40,src:"/".concat(w,".svg"),alt:""}),(0,s.jsx)(p(),{className:"absolute -right-2 -bottom-2",width:24,height:24,src:"/".concat(C,".svg"),alt:""})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h6",{className:"text-base leading-6 font-bold mt-6",children:R||"title"}),(0,s.jsxs)("div",{className:"text-slate-500 text-sm",children:["TVL: $",(0,x.dq)(O)]})]}),(0,s.jsxs)("div",{className:"flex flex-col text-sm mt-4 gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-1",children:"Current ".concat(T.assetTokenSymbol," price")}),(0,s.jsxs)("div",{className:"font-semibold",children:["$",(0,x.dq)(B[T.assetTokenSymbol])]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-1",children:"Target Price"}),(0,s.jsxs)("div",{className:"font-semibold",children:["$",(0,x.dq)(K)]})]})]}),(0,s.jsx)(b.i,{className:"my-4"}),(0,s.jsx)(b.r,{numItemsSm:2,className:"gap-y-2 gap-x-7",children:null==et?void 0:et.map(e=>(0,s.jsxs)("div",{className:"flex justify-between flex-col",children:[(0,s.jsx)("div",{className:"text-xs text-neutral-500",children:e.label}),(0,s.jsx)("div",{className:"text-neutral-900 text-sm",children:e.value})]},e.key))}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-slate-500 flex flex-col gap-3"}),(0,s.jsxs)("button",{className:"btn-secondary h-7 flex items-center w-fit self-end justify-center gap-4 ",disabled:!ea||es,onClick:()=>ea(),children:[es&&(0,s.jsx)(N.$,{}),"Claim all"]})]}),(0,s.jsxs)(f.fC,{defaultValue:"stake",className:"",children:[(0,s.jsx)(f.aV,{className:"flex gap-6 border-b border-slate-200",children:["stake","unstake"].map(e=>(0,s.jsx)(f.xz,{value:e,className:"capitalize py-1 text-sm leading-6 text-slate-400 data-[state=active]:font-medium data-[state=active]:text-slate-900 data-[state=active]:border-b data-[state=active]:border-slate-900",children:e},e))}),(0,s.jsxs)(f.VY,{value:"stake",className:"pt-4",children:[(0,s.jsx)(j.W,{amount:Z,setAmount:z,asset:w,balance:(0,x.dq)(W)}),(0,s.jsx)(y.v,{tx:"Stake",config:{abi:l.Z,address:_,functionName:"stake",args:[(0,m.su)(Z)],value:"ETH"==w?(0,m.su)(Z):0n},className:"mt-2",approves:{[S]:(0,m.su)(Z)},spender:_})]}),(0,s.jsxs)(f.VY,{value:"unstake",className:"pt-4",children:[(0,s.jsx)(j.W,{amount:I,setAmount:U,asset:w}),(0,s.jsx)(k.c,{className:"mt-8",tx:"UnStake",config:{abi:l.Z,address:_,functionName:"withdraw",args:[(0,m.su)(I)]}})]})]})]})}var T=a(77832);function EarnPage(){let e=o.iK[(0,n.B)()].find(e=>"ETH"==e.assetTokenSymbol);return e?(0,s.jsxs)("div",{className:"w-full h-full max-w-screen-xl px-4 mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Earn ETH"}),(0,s.jsxs)(T.Z,{numItemsSm:2,className:"gap-3 mt-4",children:[(0,s.jsx)(DualTokenCard,{vc:e,type:"buy"}),(0,s.jsx)(DualTokenCard,{vc:e,type:"sell"})]})]}):null}},76036:function(e,t,a){"use strict";a.d(t,{v:function(){return ApproveAndTx}});var s=a(57437),l=a(72009),n=a(81628),r=a(2265),i=a(71424),o=a(56926),c=a(30197);let u={},useApproves=function(e,t){var a;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10000000000n*BigInt(1e18),{address:d}=(0,o.mA)(),m=(0,o.t_)(),{data:v}=(0,o.py)(),x=(0,r.useMemo)(()=>Object.keys(e).filter(e=>e!==l.K8),[e]),[f,b]=(0,r.useState)(null!==(a=u[t])&&void 0!==a?a:{}),updateAllownce=(e,a)=>{var s;u[t]={...null!==(s=u[t])&&void 0!==s?s:{},[e]:a},b(t=>({...t,[e]:a}))},{data:h}=(0,o.Ov)();(0,r.useEffect)(()=>{d&&x.forEach(e=>{m.readContract({abi:c.em,address:e,functionName:"allowance",args:[d,t]}).then(t=>updateAllownce(e,t)).catch(console.error)})},[x,d,h]);let[p,g]=(0,r.useState)(!1),y=(0,r.useMemo)(()=>x.filter(t=>(e[t]||0n)>0n&&(e[t]||0n)>(f[t]||0n)),[e,x]),approve=async()=>{if(0!=y.length)try{g(!0);for(let e=0;e<y.length;e++){let a=y[e],l=await (null==v?void 0:v.writeContract({abi:c.em,address:a,functionName:"approve",args:[t,s]}));l&&await (null==m?void 0:m.waitForTransactionReceipt({hash:l})),updateAllownce(a,s)}g(!1),i.toast.success("Approve success")}catch(e){throw i.toast.error((0,n.az)(e)),g(!1),e}};return{approve,loading:p,shouldApprove:y.length>0}};var d=a(92697),m=a(72084),v=a(35769);function ApproveAndTx(e){let{className:t,tx:a,approves:l,spender:n,requestAmount:r,config:i,toast:o=!0}=e,{approve:c,shouldApprove:u,loading:x}=useApproves(l,n,r),f=!c||x||void 0!==i.enabled&&!i.enabled;return u?(0,s.jsxs)("button",{className:(0,v.m)("btn-primary flex items-center justify-center gap-4",t),onClick:c,disabled:f,children:[x&&(0,s.jsx)(m.$,{}),"Approve"]}):(0,s.jsx)(d.c,{tx:a,config:i,toast:o,className:t})}},92697:function(e,t,a){"use strict";a.d(t,{c:function(){return TxButton}});var s=a(57437),l=a(43003),n=a(72084),r=a(35769);function TxButton(e){let{className:t,config:a,toast:i=!0,tx:o}=e,{write:c,isLoading:u}=(0,l.R)(a,i);return(0,s.jsxs)("button",{className:(0,r.m)("btn-primary flex items-center justify-center gap-4",t),onClick:()=>c(),disabled:!c||u,children:[u&&(0,s.jsx)(n.$,{}),o]})}},80547:function(e,t,a){"use strict";a.d(t,{W:function(){return AssetInput}});var s=a(57437),l=a(57042),n=a(16691),r=a.n(n),i=a(2265);function AssetInput(e){let{asset:t="ETH",balance:a,exchange:n,readonly:o,selected:c,onClick:u,amount:d,setAmount:m,price:v,disable:x}=e,f=(0,i.useRef)(null);return(0,s.jsxs)("div",{className:"relative w-full",onClick:()=>{u&&!x&&u()},children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"absolute flex items-center gap-2 top-1/2 left-4 -translate-y-1/2",children:[(0,s.jsx)(r(),{width:24,height:24,src:"/".concat(t,".svg"),alt:""}),(0,s.jsxs)("div",{className:"text-base font-medium",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:t}),v&&(0,s.jsx)("div",{className:"text-neutral-500 text-xs",children:v})]}),n&&(0,s.jsxs)("div",{className:"text-slate-500 text-xs",children:["~$",n]})]})]}),(0,s.jsx)("input",{value:d,onChange:e=>m(e.target.value),ref:f,type:"number",disabled:x,className:(0,l.Z)("w-full h-14 text-right pr-4 font-bold text-2xl border text-slate-700 rounded-md focus:ring-2 focus:outline-blue-500",o?"bg-slate-50":"bg-white",c?"border-indigo-500":"border-slate-200"),placeholder:"0.00",step:.01,title:"",readOnly:o})]}),a&&(0,s.jsxs)("div",{className:"text-slate-400 pl-3 mt-1 text-sm",children:["Balance: ",a,(0,s.jsx)("button",{className:"text-indigo-500 ml-2",onClick:()=>{var e;m(null===(e=String(a))||void 0===e?void 0:e.replace(",","")),u&&!x&&u()},children:"Max"})]})]})}},72084:function(e,t,a){"use strict";a.d(t,{$:function(){return Spinner}});var s=a(57437);let Spinner=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{fill:"none",className:t?"text-white":"animate-spin h-5 w-5 2-ml-1 2mr-3",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},43003:function(e,t,a){"use strict";a.d(t,{R:function(){return useWrapContractWrite}});var s=a(81628),l=a(2265),n=a(71424),r=a(56926);function useWrapContractWrite(e){var t;let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=(0,r.PJ)(e),o=(0,r.GG)(i.config),c=(0,r.BX)({hash:null===(t=o.data)||void 0===t?void 0:t.hash}),u=o.isLoading||c.isLoading,d=o.isSuccess&&c.isSuccess;return(0,l.useEffect)(()=>{a&&(o.error?n.toast.error((0,s.az)(o.error)):d&&n.toast.success("Transaction success"))},[o.error,d]),{...o,isLoading:u,isSuccess:d}}},81628:function(e,t,a){"use strict";a.d(t,{Jh:function(){return fmtPercent},Rr:function(){return fmtAAR},az:function(){return getErrorMsg},pF:function(){return aarToNumber},su:function(){return parseEthers}});var s=a(16775),l=a(36238),n=a(43977);function getErrorMsg(e){let t="Unkown";return("string"==typeof e?t=e:"string"==typeof(null==e?void 0:e.msg)?t=null==e?void 0:e.msg:"string"==typeof(null==e?void 0:e.message)&&(t=null==e?void 0:e.message),t.includes("User denied")||t.includes("user rejected transaction"))?"You declined the action in your wallet.":t.includes("transaction failed")?"Transaction failed":t}function aarToNumber(e,t){let a=(0,s.b)(e,"bigint"==typeof t?parseInt(t.toString()):t);return parseFloat(a)}function fmtAAR(e,t){return(100*aarToNumber(e,t)).toFixed()+"%"}function parseEthers(e,t){e||(e="0"),e=e.replaceAll(",","");let a="number"==typeof t?t:l.ez[t||"wei"];return(0,n.v)(e,a)}function fmtPercent(e,t,a){let l=(0,s.b)(100n*e,t);return parseFloat(l.replaceAll(",","")).toFixed(a)+"%"}},20373:function(e,t,a){"use strict";a.d(t,{ZM:function(){return displayBalanceWithoutFormat},dq:function(){return displayBalance}});var s=a(79352);let displayBalance=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return"0.000";let a=10**t;return(Math.floor(Number((0,s.d)(e))*a)/a).toLocaleString("en-US",{maximumFractionDigits:t,minimumFractionDigits:t})},displayBalanceWithoutFormat=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return"0.000";let a=10**t;return String(Math.floor(Number((0,s.d)(e))*a)/a)}}},function(e){e.O(0,[27,986,335,129,424,273,98,203,971,472,744],function(){return e(e.s=62166)}),_N_E=e.O()}]);